######### 锚点 start #######
p: &p {type: http, interval: 3600, health-check: {enable: true, url: https://cp.cloudflare.com/generate_204, interval: 300}}

######### 锚点 end #######
proxy-providers:
  provider1:
    <<: *p
    url: "https://substore.fukbili.shop/9bs6aKqYKQf3UkQPHbx6/download/4?target=ClashMeta"
    path: ./provider1.yaml

  provider2:
    <<: *p
    url: "https://substore.fukbili.shop/9bs6aKqYKQf3UkQPHbx6/download/1?target=ClashMeta"
    path: ./provider2.yaml
  provider3:
    <<: *p
    url: "https://substore.fukbili.shop/9bs6aKqYKQf3UkQPHbx6/download/%E8%B5%94%E9%92%B1%E6%9C%BA%E5%9C%BA?target=ClashMeta"
    path: ./provider3.yaml
ipv6: true
allow-lan: true
mixed-port: 7890
unified-delay: false
tcp-concurrent: true
external-controller: 0.0.0.0:9090
external-ui: ui
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
log-level: error
find-process-mode: strict
global-client-fingerprint: chrome
profile:
  store-selected: true
  store-fake-ip: true
sniffer:
  enable: true
  override-destination: false
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: false
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
tun:
  enable: true
  stack: system
  dns-hijack:
    - "any:53"
  auto-route: true
  auto-detect-interface: true
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.0/15
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
  default-nameserver:
    - 223.5.5.5
    - 1.1.1.1
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
  proxy-server-nameserver:
    - https://1.1.1.1/dns-query
  nameserver-policy:
    "rule-set:cn_domain,private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
    "rule-set:geolocation-!cn":
      - "https://dns.cloudflare.com/dns-query#dns"
      - "https://dns.google/dns-query#dns"
proxies:
- name: "直连"
  type: direct
  udp: true
proxy-groups:
  - {name: 国外出口, type: select, proxies: [自动选择, 直连, 自建, nano, 赔钱]}
  - {name: 国内, type: select, proxies: [直连, 国外出口]}

  - name: 自建
    type: select
    use:
      - provider1
  - name: nano
    type: select
    use:
      - provider2
  - name: 赔钱
    type: select
    use:
      - provider3
  - {name: 全部节点, type: select , include-all-providers: true}
  - {name: 自动选择, type: url-test, include-all-providers: true, tolerance: 70,lazy: true}
rules:
  - RULE-SET,ads,REJECT
  - GEOIP,lan,直连,no-resolve
  - DOMAIN-KEYWORD,todesk,国内
  - DOMAIN-KEYWORD,emby,国外出口
  - RULE-SET,biliintl_domain,国外出口
  - RULE-SET,ehentai_domain,国外出口
  - RULE-SET,github_domain,国外出口
  - RULE-SET,twitter_domain,国外出口
  - RULE-SET,youtube_domain,国外出口
  - RULE-SET,google_domain,国外出口
  - RULE-SET,telegram_domain,国外出口
  - RULE-SET,netflix_domain,国外出口
  - RULE-SET,spotify_domain,国外出口
  - RULE-SET,pixiv_domain,国外出口
  - RULE-SET,cn_domain,国内
  - RULE-SET,geolocation-!cn,国外出口
  - RULE-SET,google_ip,国外出口
  - RULE-SET,netflix_ip,国外出口
  - RULE-SET,telegram_ip,国外出口
  - RULE-SET,twitter_ip,国外出口
  - RULE-SET,cn_ip,国内
  - MATCH,国外出口
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: yaml}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: yaml}
  classical: &classical {type: http, interval: 86400, behavior: classical, format: yaml}

rule-providers:
  private:
    <<: *domain
    path: ./private.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.yaml"
  cn_domain:
    <<: *domain
    path: ./cn_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.yaml"
  biliintl_domain:
    <<: *domain
    path: ./biliintl_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/biliintl.yaml"
  ehentai_domain:
    <<: *domain
    path: ./ehentai_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/ehentai.yaml"
  github_domain:
    <<: *domain
    path: ./github_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.yaml"
  twitter_domain:
    <<: *domain
    path: ./twitter_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/twitter.yaml"
  youtube_domain:
    <<: *domain
    path: ./youtube_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.yaml"
  google_domain:
    <<: *domain
    path: ./google_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.yaml"
  telegram_domain:
    <<: *domain
    path: ./telegram_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.yaml"
  netflix_domain:
    <<: *domain
    path: ./netflix_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.yaml"
  bilibili_domain:
    <<: *domain
    path: ./bilibili_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bilibili.yaml"
  bahamut_domain:
    <<: *domain
    path: ./bahamut_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bahamut.yaml"
  spotify_domain:
    <<: *domain
    path: ./spotify_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.yaml"
  pixiv_domain:
    <<: *domain
    path: ./pixiv_domain.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/pixiv.yaml"
  geolocation-!cn:
    <<: *domain
    path: ./geolocation-!cn.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.yaml"
  cn_ip:
    <<: *ip
    path: ./cn_ip.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.yaml"
  google_ip:
    <<: *ip
    path: ./google_ip.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.yaml"
  netflix_ip:
    <<: *ip
    path: ./netflix_ip.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.yaml"
  twitter_ip:
    <<: *ip
    path: ./twitter_ip.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/twitter.yaml"
  telegram_ip:
    <<: *ip
    path: ./telegram_ip.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.yaml"
  ads:
    <<: *classical
    path: ./ads.yaml
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/classical/category-ads-all.yaml"
